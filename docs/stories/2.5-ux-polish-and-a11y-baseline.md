# Story 2.5: UX Polish & A11y Baseline

## Status

Done

### Dependencies
- Story 2.1 – Minimal TradingView Chart Page (core chart rendering in place)
- Story 2.2 – Netlify Build & Static Asset Wiring (Netlify URL and deploy pipeline stable)
- Story 2.3 – Notion Embedding & Layout Integration (chart embedded above the fold with surrounding copy)
- Story 2.4 – Basic Access Control & Referer Guard (soft gate via referer + token in front of chart)

## Story

**As** a Timing Terminal member viewing the chart inside Notion  
**I want** the chart and its surrounding UI to feel visually polished and readable in a dark-themed environment  
**so that** I can confidently interpret BTC price and phase score without fighting the UI and with basic accessibility affordances in place.

A cleaner, more legible experience reduces cognitive load and friction when scanning for cycle context, making it easier to trust the signal and avoid misreading the chart under time pressure.

This story focuses on **visual polish and baseline accessibility** for the Netlify-hosted chart page rendered via TradingView Lightweight Charts and embedded into Notion. It does **not** change data, scoring logic, or access control; instead, it refines how the existing experience looks and behaves for real users.

## Acceptance Criteria

1. **Dark theme baseline applied to chart page**  
   - The chart page uses a coherent dark theme that matches or complements the surrounding Notion embed (e.g., dark background, legible text and axis colors, sufficient contrast).  
   - TradingView chart background, grid, axes, and series colors are configured for dark mode per the Architecture tech stack (custom CSS + Lightweight Charts options).  
   - No glaring mismatches (e.g., bright white background inside a dark Notion page) remain.

2. **Key chart elements labeled and legible**  
   - BTC price and phase score series are visually distinguishable (e.g., color and/or style differences).  
   - A minimal legend or inline labels clearly indicate which line is BTC price and which is the phase score.  
   - Axis tick labels and any on-chart text meet a reasonable contrast level against the background on a typical desktop display.

3. **Basic keyboard focus and interaction baseline**  
   - The chart container is reachable via keyboard (e.g., via `Tab` navigation) from the surrounding Notion page.  
   - When focused, the chart indicates focus in a subtle but visible way (e.g., outline, glow, or similar).  
   - It is documented whether keyboard-only users can perform core interactions (e.g., explain that zoom/pan/tooltips are primarily pointer-based in this MVP), and any limitations are captured as known issues rather than silently ignored.

4. **Non-text contrast and sizing are reasonable**  
   - Major visual elements (candles/line, phase line, key grid lines) are clearly visible without requiring users to tweak their display settings.  
   - Default viewport / aspect ratio continues to work well inside Notion’s embed frame from Story 2.3 (no new scrolling issues introduced by styling changes).  
   - Text size on axes and (if present) legend labels is large enough to be readable in the embedded frame on a typical laptop.

5. **Known a11y limitations documented**  
   - A short `docs/` section (or Dev Notes in this story) explicitly documents:  
     - What basic accessibility is supported (focus handling, color contrast targets, keyboard focus path).  
     - What is **not** yet accessible (e.g., no full keyboard-driven exploration of the chart, no screen-reader-friendly textual summary).  
   - This documentation references the relevant sections of the architecture and PRD where visual and UX expectations are defined.

## Tasks / Subtasks

- [x] **Task 1 – Analyze current chart UX and constraints** (AC: 1, 2, 4, 5)  
  - [x] Review Story 2.1–2.4 story docs and the live Netlify deployment to understand the current chart presentation, Notion embed behavior, and access-control guard.  
  - [x] Capture current issues: background/foreground contrast problems, unclear line labeling, cramped layout in the embed, or other obvious UX problems.  
  - [x] Document these findings briefly in the Dev Notes section of this story.

- [x] **Task 2 – Define dark theme palette and chart styling** (AC: 1, 2, 4)  
  - [x] Choose a small set of colors (background, grid, BTC line, phase-score line, axis text) that work well on dark backgrounds and align with the architecture’s guidance on minimal custom CSS and TradingView theming.  
  - [x] Update the chart styling (CSS + Lightweight Charts options) so that:  
    - [x] Page background, chart background, and axes feel coherent in a dark theme.  
    - [x] BTC price and phase-score lines are easily distinguished.  
    - [x] Grid lines are subtle enough not to distract but visible enough to orient the eye.  
  - [x] Verify that the new styling looks good both in a standalone browser view and within the Notion embed.

- [x] **Task 3 – Add minimal legend / labeling for series** (AC: 2)  
  - [x] Implement a small, unobtrusive legend or inline label area (e.g., top-left or bottom-left overlay) that clearly indicates which series is BTC price and which is the phase score.  
  - [x] Ensure the legend text is readable against the dark background and does not cover critical chart content at typical zoom levels.  
  - [x] Confirm that the legend behaves well inside the Notion embed (no clipping or overlapping with Notion UI chrome).

- [x] **Task 4 – Establish keyboard focus behavior** (AC: 3, 5)  
  - [x] Ensure the chart container element has a sensible tab stop in the DOM so that keyboard users can reach it from the surrounding Notion content.  
  - [x] Add a visible focus indicator when the chart container is focused (e.g., outline, box-shadow, or CSS class toggle).  
  - [x] Document in Dev Notes what keyboard-only users can and cannot do in this MVP (e.g., “core interactions require a pointing device; keyboard focus only identifies the region and supports basic scrolling”).

- [x] **Task 5 – Validate in Notion embed and document a11y baseline** (AC: 1, 2, 3, 4, 5)  
  - [x] Test the updated chart page inside the existing Notion embed on a typical desktop viewport to confirm:  
    - [x] Dark theme looks coherent with Notion’s surrounding UI.  
    - [x] Legend / labels and axis text remain readable at embed size.  
    - [x] No new horizontal scrollbars or layout regressions were introduced.  
  - [x] Optionally validate on at least one narrower viewport to ensure the UI remains usable (MVP quality).  
  - [x] Add or update a short `docs/` or Dev Notes section describing the current a11y baseline, key limitations, and suggested future improvements (e.g., textual summary of last phase score, stronger keyboard support, or screen-reader hints).

## Dev Notes

### Dev Agent Record

- **Model / Agent:** Dev (James)  
- **Intended behavior:**  
  - Apply a cohesive dark theme and visual polish to the existing chart page without altering data or access logic.  
  - Provide clear series labeling so that BTC price vs. phase score is obvious at a glance.  
  - Establish a minimal but explicit accessibility baseline: keyboard focus into the chart region, reasonable contrast, and documentation of remaining gaps.
- **Keyboard & a11y notes (MVP):**  
  - Chart container is now focusable via keyboard (`tabindex="0"`) and shows a visible focus ring when focused.  
  - Core interactions (zoom/pan/tooltips) remain pointer-driven; keyboard focus identifies the chart region and allows scrolling the surrounding page but does not provide full keyboard control of the chart itself.  
  - Legend is a visual-only overlay (`aria-hidden="true"`) to avoid confusing screen readers; a future story can add a textual summary or more robust screen-reader support.

### Architectural & Product Context

- The architecture defines a **static HTML + TypeScript** chart page hosted on Netlify and embedded into Notion, with TradingView Lightweight Charts and a dark-theme styling approach.  
- Visual simplicity and readability are prioritized over flashy UI; the chart must be easy to read quickly for timing decisions.  
- Access control is handled by the soft gate from Story 2.4 (referer + token) and should not be modified in this story.

> Relevant documents:  
> - `docs/architecture.md` – overall architecture, including frontend hosting and theming choices (see **High Level Architecture** and **Tech Stack** sections).  
> - `docs/stories/epic-2.frontend-chart-delivery.md` – epic outline for frontend and embedding, including the high-level definition of Story 2.5.  
> - `docs/notion-embedding-guide.md` – details on how the chart is embedded and validated inside Notion (see **Validating Layout and Interaction**).  
> - `docs/access-control.md` – description of the soft gate in front of the chart from Story 2.4.

> In particular, preserve the constraints established in Story 2.3 (chart above the fold in Notion without awkward horizontal scrollbars) and Story 2.4 (no changes to the referer + token soft gate) while applying the UX/a11y improvements in this story.

### Project Structure Notes

- Frontend chart code and static assets for this story live under the existing `web/` directory used in Stories 2.1–2.4.  
- **Primary implementation targets for this story:**  
  - `web/index.html` – chart container markup and basic layout.  
  - `web/main.js` – TradingView Lightweight Charts wiring, series config, and any DOM glue.  
- Do **not** modify `netlify/edge-functions/guard.js`, `netlify.toml`, or pipeline code in this story; access control and data generation remain exactly as implemented in Story 2.4 and Epic 1.  
- Any new styling or UI helpers introduced for this story should follow existing patterns from those stories rather than inventing a new framework or build system.  
- Tests (if added) should align with the lightweight testing approach described in the architecture doc for frontend/e2e checks.

## Testing

- **Manual:**  
  - Verify appearance and interaction of the updated chart page both standalone and in the Notion embed (dark theme, labels, focus indicator).  
  - Check keyboard navigation path from surrounding Notion content into the chart region and confirm a visible focus outline.

- **Optional automated checks:**  
  - If feasible, add a simple automated check (e.g., Playwright or similar) to confirm the chart page loads without console errors and key DOM elements (chart container, legend) are present.

## QA Results

- **Gate Decision:** PASS  
- **Scope:** Story 2.5 – UX Polish & A11y Baseline  
- **Summary:**  
  - Dark theme on the chart page is coherent with the surrounding Notion embed, and axis/label contrast is sufficient for typical desktop viewing.  
  - Centered top legend clearly distinguishes BTC price vs phase score using color and text, with no overlap on axes or main chart content at normal zoom levels.  
  - Keyboard users can move focus into the chart region (`tabindex="0"` on `#chart`) and see a visible outline; limitations of keyboard-only control are explicitly documented in Dev Notes as MVP constraints.  
  - The implementation preserves constraints from Story 2.3 (no new horizontal scrollbars, chart above the fold in Notion) and Story 2.4 (no changes to the referer + token soft gate).

- **Risks / Notes:**  
  - Accessibility remains baseline-only: there is no screen-reader-friendly textual summary of the chart and no full keyboard-driven chart interaction; these are accepted and called out as future work.  
  - Focus behavior inside Notion iframes can vary slightly across browsers/clients; manual re-check is recommended if the embed container or Notion layout changes.

- **Recommendations:**  
  - In a later story, add a short textual summary of the most recent phase score and dataQuality status near the chart for screen-reader users.  
  - Consider a lightweight automated smoke test (e.g., Playwright) that asserts presence of the legend, chart container, and no console errors after deploy.

## QA Notes (for future QA agent)

- Confirm that this story’s changes do not interfere with the access-control guard from Story 2.4 or with the embedding behavior validated in Story 2.3.  
- Validate that the chart remains readable under typical Notion embed conditions and that known accessibility gaps are explicitly documented for later stories.

## Change Log

| Date       | Version | Description                              | Author |
||------------|---------|------------------------------------------|--------|
|| 2025-12-10 | v0.1    | Initial draft of Story 2.5 created       | SM     |
|| 2025-12-10 | v1.0    | Implemented UX polish & a11y baseline    | Dev    |
