# Story 2.1: Minimal TradingView Chart Page

## Status

Ready for Review

## Story

**As** a Timing Terminal member landing on the chart page for the first time  
**I want** a fast, minimal web page that renders the Bitcoin price and phase score from `chart-data.json` using TradingView Lightweight Charts  
**so that** I can explore historical patterns and current phase without needing any additional tools or installations.

## Acceptance Criteria

1. **Static chart page reads `chart-data.json` and renders BTC + phase score**  
   - A static HTML entrypoint (e.g., `web/index.html`) and associated TypeScript/JavaScript file(s) exist to render the chart.  
   - The page loads `chart-data.json` from a configurable relative path (e.g., `./chart-data.json`).  
   - Two series are drawn:  
     - BTC price as a primary price line.  
     - Phase score as a secondary line or overlay (on a second axis or scaled appropriately), using the same time axis as price.  
   - The chart uses TradingView Lightweight Charts.

2. **Interactive basics work (zoom, pan, tooltips)**  
   - Users can zoom and pan horizontally.  
   - Hovering over the chart shows a tooltip or crosshair with:  
     - Time  
     - BTC price  
     - Phase score  
   - The chart initializes with a sensible default zoom that shows several months of history.

3. **Layout works for Notion embedding**  
   - The chart renders correctly within a fixed-width, responsive container suitable for embedding in Notion (e.g., 16:9 or similar aspect ratio).  
   - No horizontal scrollbars at typical desktop widths (e.g., 1280–1920px).  
   - The page background and basic styling align with a dark-theme chart experience.

4. **Error handling and loading states**  
   - If `chart-data.json` cannot be loaded or parsed, the page shows a simple, user-friendly error message rather than a blank screen or JS stack trace.  
   - While data is loading, the page shows a basic loading indicator.

5. **Build-friendly structure**  
   - Frontend code is organized under a dedicated directory (e.g., `web/`) with a simple build or bundling story that can be wired into Netlify in Story 2.2.  
   - Any dependencies (e.g., TradingView script) are loaded in a way that will work both locally and after deployment (e.g., via CDN or bundled asset).  
   - No backend runtime is required; the page is static and driven solely by `chart-data.json` + client-side JS.

6. **Basic technical documentation**  
   - Dev Notes or README section describes:  
     - Where the chart page lives (directory structure).  
     - How to open it locally (e.g., using a simple static file server).  
     - How it expects to find `chart-data.json` (relative path, file name).  
     - How to switch between fixture-generated and CI-generated `chart-data.json` during local testing.

## Tasks / Subtasks

- [x] **Task 1 – Define frontend structure and entrypoint** (AC: 1, 5)  
  - [x] Create a `web/` directory to hold the chart page assets.  
  - [x] Add `web/index.html` as the main entrypoint.  
  - [x] Add a JavaScript entry file `web/main.js` to encapsulate chart logic.

- [x] **Task 2 – Integrate TradingView Lightweight Charts** (AC: 1, 2)  
  - [x] Load Lightweight Charts via CDN `<script>` tag in `index.html`.  
  - [x] Initialize a chart instance on a dedicated container element.  
  - [x] Confirmed that data from `chart-data.json` renders as expected (no separate hardcoded series step needed).

- [x] **Task 3 – Wire `chart-data.json` to chart data series** (AC: 1, 2)  
  - [x] Implemented a `fetch` call in `web/main.js` to load `chart-data.json` from a relative URL.  
  - [x] Mapped `btcPrice[]` and `phaseScore[]` entries to Lightweight Charts series data structures using Unix seconds from `time` and `value` as the series value.  
  - [x] Rendered BTC price as an area series and phase score as a separate line series on a secondary scale.  
  - [x] Ensured time alignment between both series by clipping to their overlapping time range.

- [x] **Task 4 – Layout and basic styling for Notion embedding** (AC: 3)  
  - [x] Wrapped the chart in a responsive container with a 16:9 aspect ratio suitable for desktop Notion embeds.  
  - [x] Applied a dark background and minimal CSS so the chart looks clean in both standalone and embedded contexts.  
  - [ ] To be verified manually: at typical desktop widths the chart should not produce unwanted horizontal scrollbars.

- [x] **Task 5 – Loading and error states** (AC: 4)  
  - [x] Show a simple loading indicator (“Loading chart data…”) while fetching `chart-data.json`.  
  - [x] Catch fetch/parse errors and render a user-friendly message (“Chart data is currently unavailable. Please try again later.”).  
  - [x] Avoid unhandled exceptions in the console by guarding DOM lookups and wrapping the load in a try/catch.

- [x] **Task 6 – Document how to run and test the chart page locally** (AC: 6)  
  - [x] Added a section to `README.md` describing:  
    - How to serve the `web/` directory locally using `python -m http.server`.  
    - How to copy `pipeline/out/chart-data.json` into `web/` for local viewing.  
    - That the page should be served over HTTP rather than opened directly from the filesystem.

## Dev Notes

> All technical guidance here is derived from the PRD and Architecture; no new frontend framework is introduced.

### Architectural & Tech Stack Context

- **Tech Stack:** The architecture defines the frontend as a static HTML + TypeScript/JavaScript page using TradingView Lightweight Charts, hosted on Netlify.  
  - No SPA framework (React, Vue, etc.) is required for MVP.  
  - A small amount of TS/JS glue code is expected to integrate TradingView with `chart-data.json`.  
  _[Source: `docs/architecture.md#Tech Stack`, Frontend rows]_  

- **Data Contract:** The chart is driven by `chart-data.json` produced by the pipeline:  
  - `btcPrice[]` and `phaseScore[]` arrays of `{ time, value }`.  
  - `time` is Unix seconds (UTC).  
  - `dataQuality` and `lastUpdated` are available for future UX but are not strictly required for this story’s minimal chart.  
  _[Source: `docs/architecture.md#Data Models`, `#JSON Schema (chart-data.json)`]_  

- **Epic Dependencies:**  
  - Epic 1 has established a reliable `chart-data.json` generator with CI and a daily scheduled run.  
  - Epic 2 builds on this by providing a chart consumer; no additional backend logic is needed for this story.

### Design Guidance for the Chart

- **Series Mapping:**  
  - BTC price should visually read as the primary financial time series (e.g., candlestick, line, or area chart).  
  - Phase score should be clearly visible but not overpower price; using a separate line with a different color and, if needed, a separate scaled axis is acceptable.  

- **Interaction Expectations (MVP):**  
  - Zoom/pan must be usable with mouse/trackpad interactions.  
  - Tooltips/crosshair should show both BTC and phase score for the hovered time.  
  - No advanced tools (drawing tools, multiple panes) are required at this stage.

- **Embedding Considerations:**  
  - The layout should assume an iframe‑style embed in Notion, so avoid full-page layout assumptions (no full-window fixed headers, etc.).  
  - The chart container should adapt reasonably to varying iframe widths while maintaining a good height.

### Testing Expectations

- **Manual / Developer Testing:**  
  - Once the page is wired, open it locally with a static server and verify:  
    - Chart loads when a valid `chart-data.json` is present in the expected path.  
    - Zoom/pan and tooltips work.  
    - Layout looks acceptable at approximate Notion widths (e.g., 900–1200px).  
  - Intentionally break or move `chart-data.json` to confirm the error path displays a friendly message.

- **Automated Tests (Lightweight for this story):**  
  - If feasible, a very small smoke test (e.g., Playwright or similar) can be introduced in a later story; for 2.1, a manual verification step is sufficient, as long as the chart is simple and deterministic.

### Non-Goals

- No authentication, membership logic, or referer validation (this is for Story 2.4).  
- No multi-chart layout or advanced overlays (future epics).  
- No complex build tooling beyond what is necessary to bundle TypeScript/JavaScript, if TypeScript is used.

## Testing

- **Manual:**  
  - Serve `web/` statically, ensure chart renders, interacts, and handles missing `chart-data.json` gracefully.

- **Optional future automation:**  
  - A later story may add a minimal end-to-end check (e.g., CI job that boots a static server and hits the chart page to ensure no JS errors).

## QA Results

- **Gate Decision:** PASS
- **Scope:** Story 2.1 – Minimal TradingView Chart Page
- **Summary:**
  - `web/index.html` and `web/main.js` implement a static chart page that loads `chart-data.json` and renders BTC price and phase score using TradingView Lightweight Charts.
  - The chart supports zoom/pan and hover interactions and uses a Notion-friendly 16:9 responsive container with dark styling.
  - `web/main.js` fetches `./chart-data.json`, maps `btcPrice[]` and `phaseScore[]` into separate series, aligns them on a shared time axis, and reports `lastUpdated` / `dataQuality` in a status line.
  - Loading and error states are implemented: a "Loading chart data…" message during fetch, and a clear error message if data cannot be loaded or parsed.
  - README documents how to generate `chart-data.json`, copy it into `web/`, and serve the page locally via a simple HTTP server.
- **Testing:** Manually verified locally by serving `web/` and confirming that the chart renders and interacts correctly with a generated `chart-data.json`.
- **Risks / Notes:** Horizontal scroll behavior and iframe behavior in real Notion embeds should be validated in Story 2.3 when Notion integration is implemented.

## Change Log

| Date       | Version | Description                        | Author       |
|------------|---------|------------------------------------|--------------|
| 2025-12-10 | v0.1    | Initial draft of Story 2.1 created | Scrum Master |